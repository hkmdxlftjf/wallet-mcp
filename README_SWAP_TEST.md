# Uniswap V3 ä»£å¸äº¤æ¢æ¨¡æ‹Ÿæµ‹è¯•

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `swap_tokens` æ–¹æ³•åœ¨ Uniswap V3 ä¸Šè¿›è¡Œä»£å¸äº¤æ¢çš„æ¨¡æ‹Ÿæµ‹è¯•ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”„ **çœŸå®äº¤æ˜“æ¨¡æ‹Ÿ**: ä½¿ç”¨ `eth_call` è¿›è¡Œæ— é£é™©çš„äº¤æ˜“æ¨¡æ‹Ÿ
- ğŸ’° **æ»‘ç‚¹ä¿æŠ¤**: è‡ªåŠ¨è®¡ç®—æœ€å°è¾“å‡ºé‡‘é¢ï¼Œé˜²æ­¢ä»·æ ¼æ»‘ç‚¹æŸå¤±
- â›½ **Gas ä¼°ç®—**: å‡†ç¡®ä¼°ç®—äº¤æ˜“æ‰€éœ€çš„ gas è´¹ç”¨
- ğŸ“Š **è¯¦ç»†è¾“å‡º**: æ˜¾ç¤ºè¾“å…¥ã€é¢„ä¼°è¾“å‡ºã€å®é™…è¾“å‡ºå’Œ gas æˆæœ¬
- ğŸ›¡ï¸ **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œå‹å¥½çš„é”™è¯¯ä¿¡æ¯

## è¿è¡Œæ­¥éª¤

1. **è®¾ç½®ç¯å¢ƒå˜é‡**:
   ```bash
   export ETH_RPC_URL="your_ethereum_rpc_url"
   ```

2. **è¿è¡Œæµ‹è¯•**:
   ```bash
   cargo run --example swap_test
   ```

## æµ‹è¯•ç”¨ä¾‹

### 1. ETH -> USDT
- è¾“å…¥: 1.0 ETH
- æ»‘ç‚¹: 0.5%
- æµ‹è¯•ä¸»æµäº¤æ˜“å¯¹çš„æµåŠ¨æ€§

### 2. USDT -> WBTC
- è¾“å…¥: 1000.0 USDT
- æ»‘ç‚¹: 1.0%
- æµ‹è¯•ç¨³å®šå¸åˆ°æ¯”ç‰¹å¸çš„äº¤æ¢

### 3. WBTC -> UNI (é«˜æ»‘ç‚¹)
- è¾“å…¥: 0.1 WBTC
- æ»‘ç‚¹: 2.0%
- æµ‹è¯•é«˜æ»‘ç‚¹è®¾ç½®ä¸‹çš„äº¤æ¢

### 4. æ— æ•ˆä»£å¸å¯¹
- ä½¿ç”¨æ— æ•ˆåœ°å€æµ‹è¯•é”™è¯¯å¤„ç†

## è¾“å‡ºç¤ºä¾‹

### æˆåŠŸäº¤æ¢
```
ğŸ”„ Swap Simulation Results:
ğŸ“¥ Input: 1.0 WETH
ğŸ“¤ Estimated Output: 3456.78 USDT
ğŸ“¤ Actual Output (Simulated): 3454.32 USDT
ğŸ’° Minimum Output (0.5% slippage): 3439.12 USDT
â›½ Estimated Gas: 185000 units
ğŸ’¸ Estimated Gas Cost: 0.0037 ETH
âœ… Simulation Status: SUCCESS
```

### å¤±è´¥äº¤æ¢
```
âŒ Swap Simulation Failed:
ğŸ“¥ Input: 1.0 INVALID
ğŸ“¤ Estimated Output: 0 USDT
ğŸ’° Minimum Output (0.5% slippage): 0 USDT
ğŸš« Error: Contract call reverted
ğŸ’¡ Possible reasons: Insufficient liquidity, invalid token pair, or slippage too low
```

## æŠ€æœ¯å®ç°

### äº¤æ˜“æ„å»º
- ä½¿ç”¨ Uniswap V3 Router åˆçº¦
- æ„å»º `ExactInputSingleParams` å‚æ•°
- è®¾ç½® 20 åˆ†é’Ÿçš„äº¤æ˜“æˆªæ­¢æ—¶é—´

### æ¨¡æ‹Ÿæ‰§è¡Œ
- ä½¿ç”¨ `eth_call` è¿›è¡Œæ— çŠ¶æ€è°ƒç”¨
- ä¸æ¶ˆè€— gasï¼Œä¸æ”¹å˜åŒºå—é“¾çŠ¶æ€
- è¿”å›é¢„æœŸçš„äº¤æ¢ç»“æœ

### Gas ä¼°ç®—
- ä½¿ç”¨ `estimate_gas` è·å–å‡†ç¡®çš„ gas æ¶ˆè€—
- è·å–å½“å‰ç½‘ç»œçš„ gas price
- è®¡ç®—æ€»çš„äº¤æ˜“æˆæœ¬

## æ³¨æ„äº‹é¡¹

1. **RPC é™åˆ¶**: å…è´¹çš„ RPC èŠ‚ç‚¹å¯èƒ½æœ‰è¯·æ±‚é¢‘ç‡é™åˆ¶
2. **ç½‘ç»œçŠ¶æ€**: æ¨¡æ‹Ÿç»“æœåŸºäºå½“å‰åŒºå—çŠ¶æ€
3. **æ»‘ç‚¹è®¾ç½®**: è¿‡ä½çš„æ»‘ç‚¹å¯èƒ½å¯¼è‡´äº¤æ˜“å¤±è´¥
4. **æµåŠ¨æ€§**: æŸäº›ä»£å¸å¯¹å¯èƒ½æµåŠ¨æ€§ä¸è¶³

## è‡ªå®šä¹‰æµ‹è¯•

ä½ å¯ä»¥ä¿®æ”¹ `examples/swap_test.rs` æ–‡ä»¶æ¥æµ‹è¯•å…¶ä»–ä»£å¸å¯¹ï¼š

```rust
let swap_params = SwapParams {
    from_token: "ä»£å¸Aåœ°å€".to_string(),
    to_token: "ä»£å¸Båœ°å€".to_string(),
    amount: "äº¤æ¢æ•°é‡".to_string(),
    slippage: "æ»‘ç‚¹ç™¾åˆ†æ¯”".to_string(),
};
```

## å¸¸è§ä»£å¸åœ°å€

- **WETH**: `0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2`
- **USDT**: `0xdAC17F958D2ee523a2206206994597C13D831ec7`
- **USDC**: `0xA0b86a33E6441b8C4505B8C4505B8C4505B8C4505`
- **WBTC**: `0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599`
- **UNI**: `0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984`